<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Patient Safety Exam</title>

<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { border-bottom: 2px solid #444; }
  .option { margin: 8px 0; }
  button { padding: 8px 14px; margin-top: 15px; }
  #dashboard { display: none; border-top: 3px solid #000; margin-top: 30px; padding-top: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; }
  th { background: #f4f4f4; }
  .unsafe { color: #b00020; font-weight: bold; }
  .safe { color: #006400; font-weight: bold; }
</style>
</head>

<body oncontextmenu="return false;">

<h1>Patient Safety Assessment</h1>

<!-- EXAM AREA -->
<div id="exam">

<h2 id="qTitle"></h2>
<p id="qText"></p>

<div id="options"></div>

<button onclick="nextQuestion()">Next</button>

</div>

<!-- INSTRUCTOR DASHBOARD -->
<div id="dashboard">

<h1>Instructor Dashboard</h1>

<h2>Safety Summary</h2>
<ul>
  <li><strong>Total Unsafe Decisions:</strong> <span id="unsafeCount"></span></li>
  <li><strong>Gatekeeper Failure:</strong> <span id="gateFail"></span></li>
</ul>

<h2>Unsafe Reasoning Patterns</h2>
<table>
<tr>
  <th>Pattern</th>
  <th>Count</th>
  <th>Prometric Meaning</th>
</tr>
<tr>
  <td>Delay Action</td>
  <td id="u_delay"></td>
  <td>Did not act immediately</td>
</tr>
<tr>
  <td>Ignore ABC</td>
  <td id="u_abc"></td>
  <td>Missed airway/breathing priority</td>
</tr>
<tr>
  <td>Wait for Order</td>
  <td id="u_wait"></td>
  <td>Authority dependency</td>
</tr>
<tr>
  <td>False Reassurance</td>
  <td id="u_false"></td>
  <td>Minimized patient risk</td>
</tr>
<tr>
  <td>Out of Scope</td>
  <td id="u_scope"></td>
  <td>Unsafe nurse action</td>
</tr>
</table>

<h2>Risk Interpretation</h2>
<p id="riskText" class="unsafe"></p>

<button onclick="toggleDashboard()">Return to Exam</button>

</div>

<script>
/* ===============================
   CONFIG
================================ */
let mode = "exam";
let current = 0;
let unsafeCount = 0;
let failedGatekeeper = false;

let unsafeLog = {
  delay_action: 0,
  ignore_ABC: 0,
  wait_for_order: 0,
  false_reassurance: 0,
  out_of_scope: 0
};

/* ===============================
   QUESTIONS (SCALABLE TO 100)
================================ */
const questions = [
{
  title: "Item 1 (Gatekeeper)",
  text: "Patient suddenly becomes short of breath during ambulation.",
  gatekeeper: true,
  options: [
    { text: "Document the finding", unsafe: "delay_action" },
    { text: "Notify physician", unsafe: "wait_for_order" },
    { text: "Stop activity and assess breathing", correct: true },
    { text: "Reassure the patient", unsafe: "false_reassurance" }
  ]
},
{
  title: "Item 2",
  text: "Patient reports dizziness when standing.",
  gatekeeper: false,
  options: [
    { text: "Assist patient to sit and assess vital signs", correct: true },
    { text: "Encourage patient to walk it off", unsafe: "ignore_ABC" },
    { text: "Document and continue care", unsafe: "delay_action" },
    { text: "Wait for provider instruction", unsafe: "wait_for_order" }
  ]
}

/* ðŸ‘‰ Add items 3â€“100 here using same structure */
];

/* ===============================
   RENDER
================================ */
function renderQuestion() {
  const q = questions[current];
  document.getElementById("qTitle").innerText = q.title;
  document.getElementById("qText").innerText = q.text;

  const optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  q.options.forEach((o, i) => {
    const d = document.createElement("div");
    d.className = "option";
    d.innerHTML = `
      <label>
        <input type="radio" name="opt" value="${i}">
        ${o.text}
      </label>`;
    optDiv.appendChild(d);
  });
}

function nextQuestion() {
  const selected = document.querySelector('input[name="opt"]:checked');
  if (!selected) return alert("Select an answer");

  const q = questions[current];
  const choice = q.options[selected.value];

  if (!choice.correct) {
    unsafeCount++;
    if (choice.unsafe) unsafeLog[choice.unsafe]++;
    if (q.gatekeeper) failedGatekeeper = true;
  }

  current++;

  if (current < questions.length) {
    renderQuestion();
  } else {
    alert("Exam complete");
  }
}

/* ===============================
   DASHBOARD TOGGLE
================================ */
function toggleDashboard() {
  if (mode === "exam") {
    const pwd = prompt("Instructor password:");
    if (pwd !== "SAFE123") return;
    showDashboard();
    mode = "dashboard";
  } else {
    showExam();
    mode = "exam";
  }
}

function showDashboard() {
  document.getElementById("exam").style.display = "none";
  document.getElementById("dashboard").style.display = "block";

  document.getElementById("unsafeCount").innerText = unsafeCount;
  document.getElementById("gateFail").innerText =
    failedGatekeeper ? "YES (AUTO FAIL)" : "NO";

  document.getElementById("u_delay").innerText = unsafeLog.delay_action;
  document.getElementById("u_abc").innerText = unsafeLog.ignore_ABC;
  document.getElementById("u_wait").innerText = unsafeLog.wait_for_order;
  document.getElementById("u_false").innerText = unsafeLog.false_reassurance;
  document.getElementById("u_scope").innerText = unsafeLog.out_of_scope;

  let risk = "LOW RISK";
  if (failedGatekeeper) risk = "AUTO FAIL â€“ PATIENT SAFETY VIOLATION";
  else if (unsafeCount >= 2) risk = "HIGH RISK â€“ UNSAFE JUDGMENT PATTERN";
  else if (unsafeCount === 1) risk = "MODERATE RISK â€“ REVIEW REQUIRED";

  document.getElementById("riskText").innerText = risk;
}

function showExam() {
  document.getElementById("dashboard").style.display = "none";
  document.getElementById("exam").style.display = "block";
}

/* ===============================
   SECRET KEY TO OPEN DASHBOARD
================================ */
document.addEventListener("keydown", function(e) {
  if (e.ctrlKey && e.shiftKey && e.key === "D") {
    toggleDashboard();
  }
});

/* ===============================
   INIT
================================ */
renderQuestion();
</script>

</body>
</html>
