<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>All-in-One Patient Safety Exam</title>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h2 { border-bottom: 2px solid #333; margin-top: 30px; }
.option { margin: 8px 0; }
button { padding: 8px 14px; margin-top: 15px; }
#dashboard { display:none; border-top:4px solid #000; margin-top:40px; padding-top:20px; }
table { width:100%; border-collapse:collapse; }
th,td { border:1px solid #ccc; padding:8px; vertical-align:top; }
th { background:#f0f0f0; }
.safe { color:#006400; font-weight:bold; }
.unsafe { color:#b00020; font-weight:bold; }
.small { font-size:0.9em; color:#555; }
</style>
</head>

<body oncontextmenu="return false;">

<h1>Patient Safety Assessment</h1>

<!-- ================= EXAM ================= -->
<div id="exam">
  <h2 id="qTitle"></h2>
  <p id="qText"></p>
  <div id="options"></div>
  <button onclick="nextQuestion()">Next</button>
</div>

<!-- ============ INSTRUCTOR RATIONALE DASHBOARD ============ -->
<div id="dashboard">

<h1>Instructor Rationale Dashboard</h1>

<h2>Safety Outcome</h2>
<ul>
  <li><strong>Unsafe Decisions:</strong> <span id="unsafeCount"></span></li>
  <li><strong>Gatekeeper Failure:</strong> <span id="gateFail"></span></li>
  <li><strong>Final Risk:</strong> <span id="riskText" class="unsafe"></span></li>
</ul>

<h2>Item-by-Item Medical Rationale</h2>
<div id="rationaleContainer"></div>

<button onclick="toggleDashboard()">Return to Exam</button>
</div>

<script>
/* ============== STATE ============== */
let current = 0;
let unsafeCount = 0;
let failedGatekeeper = false;
let mode = "exam";
let responses = [];

/* ============== QUESTIONS (1–100 READY) ============== */
const questions = [
{
  title: "Item 1 (Gatekeeper)",
  text: "Patient suddenly becomes short of breath while ambulating.",
  gatekeeper: true,
  correctRationale:
    "Sudden dyspnea during activity may indicate hypoxia or acute cardiopulmonary compromise. The nurse must stop the activity and assess airway and breathing immediately to prevent deterioration.",
  prometricTarget:
    "Tests ABC prioritization and immediate nurse-led intervention without delay.",
  options: [
    { text:"Document the finding", unsafeType:"Delay Action",
      rationale:"Documentation does not address immediate respiratory risk." },
    { text:"Notify physician", unsafeType:"Wait for Order",
      rationale:"Delays a time-critical action within nursing scope." },
    { text:"Stop activity and assess breathing", correct:true },
    { text:"Reassure the patient", unsafeType:"False Reassurance",
      rationale:"Minimizes a potentially life-threatening symptom." }
  ]
},
{
  title: "Item 2",
  text: "Patient reports dizziness when standing from bed.",
  gatekeeper:false,
  correctRationale:
    "Dizziness on standing suggests orthostatic hypotension. Sitting the patient and assessing vitals prevents falls and injury.",
  prometricTarget:
    "Tests safety positioning and assessment before continuation of care.",
  options: [
    { text:"Assist patient to sit and assess vital signs", correct:true },
    { text:"Encourage patient to walk it off", unsafeType:"Ignore Safety",
      rationale:"Increases fall risk without assessment." },
    { text:"Document and continue care", unsafeType:"Delay Action",
      rationale:"Fails to address immediate safety concern." },
    { text:"Wait for provider instruction", unsafeType:"Wait for Order",
      rationale:"Unnecessary escalation delays prevention." }
  ]
}

/* ➕ ADD ITEMS 3–100 HERE — SAME STRUCTURE */
];

/* ============== RENDER ============== */
function renderQuestion() {
  const q = questions[current];
  qTitle.innerText = q.title;
  qText.innerText = q.text;
  options.innerHTML = "";
  q.options.forEach((o,i)=>{
    options.innerHTML += `
      <div class="option">
        <label>
          <input type="radio" name="opt" value="${i}"> ${o.text}
        </label>
      </div>`;
  });
}

function nextQuestion() {
  const sel = document.querySelector('input[name="opt"]:checked');
  if(!sel) return alert("Select an answer");
  const q = questions[current];
  const c = q.options[sel.value];

  responses.push({
    title:q.title,
    scenario:q.text,
    correctRationale:q.correctRationale,
    prometricTarget:q.prometricTarget,
    selected:c.text,
    correct:!!c.correct,
    unsafeType:c.unsafeType||null,
    unsafeRationale:c.rationale||null
  });

  if(!c.correct){
    unsafeCount++;
    if(q.gatekeeper) failedGatekeeper = true;
  }

  current++;
  if(current < questions.length) renderQuestion();
  else alert("Exam complete");
}

/* ============== DASHBOARD ============== */
function toggleDashboard(){
  if(mode==="exam"){
    if(prompt("Instructor password:")!=="SAFE123") return;
    showDashboard(); mode="dashboard";
  } else { showExam(); mode="exam"; }
}

function showDashboard(){
  exam.style.display="none";
  dashboard.style.display="block";
  unsafeCountSpan.innerText = unsafeCount;
  gateFail.innerText = failedGatekeeper ? "YES – AUTO FAIL" : "NO";
  riskText.innerText =
    failedGatekeeper ? "AUTO FAIL – PATIENT SAFETY VIOLATION" :
    unsafeCount>=2 ? "HIGH RISK – UNSAFE JUDGMENT PATTERN" :
    unsafeCount===1 ? "MODERATE RISK – REVIEW REQUIRED" :
    "LOW RISK";

  rationaleContainer.innerHTML="";
  responses.forEach(r=>{
    rationaleContainer.innerHTML += `
      <h3>${r.title}</h3>
      <p><strong>Scenario:</strong> ${r.scenario}</p>
      <p class="safe"><strong>Correct Medical Rationale:</strong> ${r.correctRationale}</p>
      <p><strong>Selected:</strong> ${r.selected}</p>
      ${r.correct
        ? `<p class="safe">Correct – safe reasoning.</p>`
        : `<p class="unsafe"><strong>Unsafe:</strong> ${r.unsafeType}<br>
           <span class="small">${r.unsafeRationale}</span></p>`}
      <p><strong>Prometric Target:</strong> ${r.prometricTarget}</p>
      <hr>`;
  });
}

function showExam(){
  dashboard.style.display="none";
  exam.style.display="block";
}

/* SECRET KEY */
document.addEventListener("keydown",e=>{
  if(e.ctrlKey && e.shiftKey && e.key==="D") toggleDashboard();
});

/* INIT */
renderQuestion();
</script>

</body>
</html>
